<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-03-18 二 12:40 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Markup Tests</title>
<meta name="author" content="Floyd Tao" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="note-style.css"/>
</head>
<body>
<div id="content" class="content">
<header>
<h1 class="title">Markup Tests</h1>
</header><div id="outline-container-org6be7e7d" class="outline-2">
<h2 id="org6be7e7d">使用 Emacs Org-Mode 构建博客</h2>
<div class="outline-text-2" id="text-org6be7e7d">
<p>
最近受够了 <code>Hugo + Org-Mode</code> 的工作流：首先使用 <code>ox-hugo</code> 导出至 <code>Hugo</code> 兼容的 <code>Markdown</code> 格式，你需要折腾 Org；由于用了 Hugo，你需要折腾 Hugo 的 cofig、theme等一系列问题；最后你还得折腾 CI 以在托管构建项目。
</p>

<p>
同时，Hugo并不具备很强的配置性：基本上只能维护一个 Blog 列表以及独立的 index.md，如果你需要不同的子结构则需要一系列的 <i>Hacking</i> 。更重要的是，如果你希望手动嵌入一些手写的 html 页面，则需要在 Hugo 构建之后手动注入。
</p>

<p>
加上希望从 Github Pages 迁移至 <a href="https://developers.cloudflare.com/pages/">Cloudflare Pages</a> ，决定使用 <b>Pure</b> Emacs 工作流重构博客。
</p>
</div>
<div id="outline-container-org08e4384" class="outline-3">
<h3 id="org08e4384">折腾记忆</h3>
<div class="outline-text-3" id="text-org08e4384">
<p>
俱往矣还是在高三下学期的激情岁月，当时几乎所有人都在没收通信设置、没有互联网的绝望境地。有几位Nerd擅长苦中作乐，开始投身于文学创作的苦路。当时我和若干好友开始写魔怔小手帐，其中尤为某孙桑的作品最为瑰丽。2022年到了大一，由于时间更为充裕，开始更加疯狂的制作日记手帐。然后某个下午冲浪时访问了一个博客（已经想不起来了），被华丽而优雅的页面所震撼，加上当时在用 <code>Qt</code> 做一些项目，沉迷于 UI 设计，于是决定自己维护一个博客。当时使用的是 <code>Hexo</code> + <code>Github Pages</code> ，尽可能了最 <i>花里胡哨</i> 的主题。当时主要记录的是 C++、CUDA 以及一些图形学的笔记和一些比较羞耻的日记，但主要还是在折腾博客的主题。我当时尽可能的往主题塞各种东西：桌宠、加载动画等等，导致博客加载通常需要十来秒。但也没怎么写东西了。到了23年左右，开始从 <code>Neovim</code> 切换到 <code>GNU Emacs</code> ，当时开始使用 Org-mode 写日记和 <i>GTD</i> ，就有了使用 <code>Org-mode</code> 构建博客的念头。当时比较成熟的就是 <code>ox-hugo</code> 的方案，于是就决定从 <code>Hexo</code> 迁移到 <code>Hugo</code> ，然后 <b>第一次冲击</b> 来了，当时居然直接把 <span class="underline">博客1.0</span> 删了，现在想想还是相当可惜。然后 <code>ox-hugo</code> 的方案用了一年多，到了 2024 年底，大概也屯了十来个博客，结果 <b>第二次冲击</b> 来了，Github 删库后准备重新 push 的，结果旧电脑坏了，目前还没动机抢救（本来就没水多少博客）。
</p>
</div>
</div>
<div id="outline-container-orge495f17" class="outline-3">
<h3 id="orge495f17">折腾目标</h3>
<div class="outline-text-3" id="text-orge495f17">
<ol class="org-ol">
<li>轻量级且可高度 DIY</li>
<li>没有外部软件依赖</li>
</ol>
</div>
<div id="outline-container-orgee4b345" class="outline-4">
<h4 id="orgee4b345">工具</h4>
<div class="outline-text-4" id="text-orgee4b345">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">编辑器</td>
<td class="org-left"><a href="https://www.gnu.org/software/emacs/">GNU Emacs</a></td>
</tr>

<tr>
<td class="org-left">编辑语言</td>
<td class="org-left"><a href="https://orgmode.org">Org-mode</a></td>
</tr>

<tr>
<td class="org-left">Site Generator</td>
<td class="org-left"><a href="https://github.com/emacsmirror/org/blob/master/lisp/ox-html.el">ox-html.el</a> &amp; <a href="https://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html">ox-publish</a></td>
</tr>

<tr>
<td class="org-left">网站托管</td>
<td class="org-left"><a href="https://blog.skk.moe/post/deploy-blog-to-cf-workers-site/">Cloudflare Workers Site</a></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org907d492" class="outline-3">
<h3 id="org907d492">使用 ox-html 导出 html5</h3>
<div class="outline-text-3" id="text-org907d492">
<p>
org-mode 原生支持各种格式的 <a href="https://orgmode.org/manual/Exporting.html">导出</a> ，你可以通过 <code>org-export-dispatch</code> 函数打开一个导出分派器的 ui，并在里面选择各种导出选项。这里给出博客导出设定的 snippet，具体导出设定请见 <a href="https://orgmode.org/manual/HTML-Export.html">org-mode manual 13.9</a> :
</p>

<div class="org-src-container">
<pre class="src src-org">#+TITLE: Article Title

#+OPTIONS: toc:nil H:4 ^:nil pri:t
#+OPTIONS: html-style:nil
#+OPTIONS: html5-fancy:t
#+HTML_DOCTYPE: html5
#+HTML_HEAD: &lt;link rel="stylesheet" type="text/css" href="org.css"/&gt;

#+BEGIN_abstract
Article abstract.
#+END_abstract

#+TOC: headlines 2

Your content goes here.
</pre>
</div>

<p>
这里选择导出为 <a href="https://developer.mozilla.org/en-US/docs/Glossary/HTML5">html5</a> 格式并关闭了默认导出的 css 和指定了博客的 css。
</p>
</div>
</div>
<div id="outline-container-org7c5f63e" class="outline-3">
<h3 id="org7c5f63e">使用 ox-publish 构建博客</h3>
<div class="outline-text-3" id="text-org7c5f63e">
<p>
个人认为 <a href="https://github.com/emacs-mirror/emacs/blob/master/lisp/org/ox-publish.el">ox-publish.el</a> 实际上相当于 Makefile，所谓 <i>publish</i> 就是根据源文件生成一些文件并移动到构建目标。这里参考 <a href="https://taingram.org">Thomas Ingram</a> 的博客。我的博客使用以下 <code>project structure</code> ：
</p>

<pre class="example" id="orgde8d0d3">
~/fuloido.moe/
├── src/                    # blog source files to be exported
│   ├── notes/
│   │   ├── index.html      # `notes' pages directory
|   |   ├── note-style.css  # note specific css
|   |   ├─- note-script.js  # note specific script
|   |   └── example-note/
|   |       ├─ example.png
|   |       └- example.org
│   ├── posts/              # `posts' pages directory
│   ├── index.html
│   ├── robots.txt
|   ├─- common-style.css
│   └── common-script.js
├── public/                 # target export directory
├── publish.el              # site sepecifc publishing config
└── Makefile                # for building the site outside of Emacs
</pre>

<p>
只设定 <code>org-publish-project-alist</code> 就可以将项目结构解释给 <code>ox-publish</code> 以导出博客：
</p>

<div class="org-src-container">
<pre class="src src-elisp">(setq org -publish-project-alist
        `(("pages"
           :base-directory "./src/"
           :base-extension "org"
           :recursive t
           :publishing-directory "./public/"
           :publishing-function org-html-publish-to-html)

          ("static"
           :base-directory "./src/"
           :base-extension "css\\|txt\\|jpg\\|gif\\|png\\|html"
           :recursive t
           :publishing-directory  "./public/"
           :publishing-function org-publish-attachment)

          ("fuloido.moe" :components ("pages" "static"))))
</pre>
</div>

<p>
这里使用 <code>ruby</code> 预览网站， <code>python</code> 或者 <code>node</code> 也不赖 ：
</p>

<div class="org-src-container">
<pre class="src src-shell">ruby -run -e httpd . -p 8000
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2025-03-18 二 00:00</p>
<p class="author">Author: Floyd Tao</p>
<p class="date">Created: 2025-03-18 二 12:40</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
